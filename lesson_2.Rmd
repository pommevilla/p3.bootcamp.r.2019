---
title: "Lesson 2: Getting started with ggplot2"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = TRUE)
```


Hadley Wickham, chief scientist at RStudio (and ISU alum!), said in [A Layered Grammar of Graphics](https://vita.had.co.nz/papers/layered-grammar.pdf):

> A grammar of graphics is a tool that enables us to concisely describe the components of a graphic. 

The `ggplot2` package is built around the idea of "building up a graphic from multiple layers of data." In other words, we're building up our plot from individual pieces, one function call at a time.

The function call for ggplot is:

```{r, eval = FALSE}
ggplot(data, mapping = aes(...)) + 
  <geom_layers> + 
  <additional layers>
```

Here, each of the different objects represents a layer:

*`data` is the data object that you would like to visualize and `mapping` contains the aesthetic mappings to use; that is, the mapping of which aesthetics to which variables. 
*`geom_layers` are what actually draw the points onto the canvas; for example, `geom_point` will create a scatter plot. 
* There are additional layers you can use to make your graph prettier.

A `ggplot` call might look like:

```{r}
mtcars %>% 
  ggplot(aes(x = wt, y = mpg)) + 
  geom_point()
```

Let's change the x- and y-axis titles to be a little more informative:

```{r}
mtcars %>% 
  ggplot(aes(x = wt, y = mpg)) + 
  geom_point() +
  labs(x = "Weight (in thousands of lbs)",
       y = "Miles per gallon")
```

We can also introduce other aesthetics into the plot. For example, let's color the dots by the number of cylinders they have:

```{r}
mtcars %>% 
  ggplot(aes(x = wt, y = mpg)) + 
  geom_point(aes(color = cyl)) +
  labs(x = "Weight (in thousands of lbs)",
       y = "Miles per gallon")
```

We can also change the size of the points by setting `size` to a specific number:

```{r}
mtcars %>% 
  ggplot(aes(x = wt, y = mpg)) + 
  geom_point(aes(color = cyl), 
             size = 3) +
  labs(x = "Weight (in thousands of lbs)",
       y = "Miles per gallon")
```

And let's change a few more things to make the graph a bit prettier:

```{r}
mtcars %>% 
  ggplot(aes(x = wt, y = mpg)) + 
  geom_point(aes(color = cyl)) +
  labs(x = "Weight",
       y = "Miles per gallon",
       title = "Miles per gallon versus weight for automobiles",
       subtitle = "Data from Motor Trend magazine") + 
  theme_light()
```


### Exercises 2.1

* We colored the points according to the number of cylinders it has, but there's something wrong with it. What is it? How can we fix it?
* What are some things we can do to improve this graph? 
* What are conclusions you can draw from this graph? 
* Experiment with the color aesthetic by mapping it to different variables. Try mapping another variable to the `size` aesthetic (`qsec`, for instance).
* Use `?theme_light` and try out a few other themes.

## More visualizations

For the rest of the day, we're going to work more with the `flights` dataset. Let's begin by getting a histogram of the flights using `geom_bar`:

```{r}
flights %>% 
  ggplot(aes(x = carrier)) + 
  geom_bar()
```

We can look up the airline codes by using `airlines`. Doing so, we see that United Airlines, JetBlue, and ExpressJet Airlines have the most flights out of New York in 2013.

```{r}
airlines %>% 
  filter(carrier %in% c("UA", "EV", "B6"))
```

Let's fill in the bars with the name of the origin airport:

```{r}
flights %>% 
  ggplot(aes(x = carrier, fill = origin)) + 
  geom_bar()
```

Let's polish the graph a little:


```{r}
flights %>% 
  ggplot(aes(x = carrier, fill = origin)) + 
  geom_bar() + 
  labs(x = "Carrier",
       y = "",
       title = "Number of flights from New York airports by carrier",
       fill = "Origin")
```



```{r}
flights %>% 
  ggplot(aes(x = carrier, fill = origin)) + 
  geom_bar() + 
  facet_wrap(~ origin, ncol = 1) +
  labs(x = "Carrier",
       y = "",
       title = "Number of flights from New York airports by carrier and origin",
       fill = "Origin") +
  theme(legend.position = "none")
```



```{r}
flights %>% 
  count(carrier, sort = TRUE) %>% 
  mutate(carrier = fct_reorder(carrier, n)) %>% 
  ggplot(aes(carrier, n)) +
  geom_col() + coord_flip()
```




```{r}
flights %>% 
  count(carrier) %>% 
  ggplot(aes(x = reorder(carrier, n), y = n)) + 
  geom_col()
```

* Next section: [Next steps](https://pommevilla.github.io/p3.bootcamp.r.2019/next_steps.html)